{"version":3,"sources":["../src/trackingPromise.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\r\nconst TRACKING_PROMISE_SYMBOL = Symbol(\"TRACKING_PROMISE_SYMBOL\");\r\n\r\ntype PromiseStatus<T> =\r\n  | { state: \"pending\" }\r\n  | { state: \"resolved\"; data: T }\r\n  | { state: \"rejected\"; error: unknown };\r\n\r\nexport type TrackingPromise<T> = Promise<T> & {\r\n  id: number;\r\n  status: PromiseStatus<T>;\r\n  [TRACKING_PROMISE_SYMBOL]: true;\r\n};\r\n\r\nexport function trackPromise<T>(\r\n  id: number,\r\n  promise: Promise<T>\r\n): TrackingPromise<T> {\r\n  const tracking = Object.assign(promise, {\r\n    id,\r\n    status: { state: \"pending\" },\r\n    [TRACKING_PROMISE_SYMBOL]: true,\r\n  }) as TrackingPromise<T>;\r\n\r\n  tracking\r\n    .then((data) => {\r\n      tracking.status = {\r\n        state: \"resolved\",\r\n        data,\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      tracking.status = {\r\n        state: \"rejected\",\r\n        error,\r\n      };\r\n    });\r\n\r\n  return tracking;\r\n}\r\n\r\nexport function isTrackingPromise(\r\n  value: any\r\n): value is TrackingPromise<unknown> {\r\n  return (\r\n    value != null &&\r\n    typeof value.id === \"number\" &&\r\n    typeof value.status === \"object\" &&\r\n    value[TRACKING_PROMISE_SYMBOL] === true &&\r\n    value instanceof Promise\r\n  );\r\n}\r\n\r\nexport async function forEachPromise<T = unknown>(\r\n  promises: TrackingPromise<T>[],\r\n  callbacks: {\r\n    onResolved: (state: { data: T; id: number }) => void;\r\n    onRejected?: (state: { error: unknown; id: number }) => void;\r\n  }\r\n) {\r\n  const { onResolved, onRejected } = callbacks;\r\n  const pendingPromises: Promise<void>[] = [];\r\n\r\n  for (const p of promises) {\r\n    let resolving = p.then((data) => {\r\n      onResolved({ id: p.id, data });\r\n    });\r\n\r\n    if (onRejected) {\r\n      resolving = resolving.catch((error) => {\r\n        onRejected({ id: p.id, error });\r\n      });\r\n    }\r\n\r\n    pendingPromises.push(resolving);\r\n  }\r\n\r\n  await Promise.all(pendingPromises);\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,IAAM,0BAA0B,OAAO,yBAAyB;AAazD,SAAS,aACd,IACA,SACoB;AACpB,QAAM,WAAW,OAAO,OAAO,SAAS;AAAA,IACtC;AAAA,IACA,QAAQ,EAAE,OAAO,UAAU;AAAA,IAC3B,CAAC,uBAAuB,GAAG;AAAA,EAC7B,CAAC;AAED,WACG,KAAK,CAAC,SAAS;AACd,aAAS,SAAS;AAAA,MAChB,OAAO;AAAA,MACP;AAAA,IACF;AAAA,EACF,CAAC,EACA,MAAM,CAAC,UAAU;AAChB,aAAS,SAAS;AAAA,MAChB,OAAO;AAAA,MACP;AAAA,IACF;AAAA,EACF,CAAC;AAEH,SAAO;AACT;AAEO,SAAS,kBACd,OACmC;AACnC,SACE,SAAS,QACT,OAAO,MAAM,OAAO,YACpB,OAAO,MAAM,WAAW,YACxB,MAAM,uBAAuB,MAAM,QACnC,iBAAiB;AAErB;AAEA,eAAsB,eACpB,UACA,WAIA;AACA,QAAM,EAAE,YAAY,WAAW,IAAI;AACnC,QAAM,kBAAmC,CAAC;AAE1C,aAAW,KAAK,UAAU;AACxB,QAAI,YAAY,EAAE,KAAK,CAAC,SAAS;AAC/B,iBAAW,EAAE,IAAI,EAAE,IAAI,KAAK,CAAC;AAAA,IAC/B,CAAC;AAED,QAAI,YAAY;AACd,kBAAY,UAAU,MAAM,CAAC,UAAU;AACrC,mBAAW,EAAE,IAAI,EAAE,IAAI,MAAM,CAAC;AAAA,MAChC,CAAC;AAAA,IACH;AAEA,oBAAgB,KAAK,SAAS;AAAA,EAChC;AAEA,QAAM,QAAQ,IAAI,eAAe;AACnC;","names":[]}